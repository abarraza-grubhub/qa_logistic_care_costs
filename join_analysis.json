{
  "metadata": {
    "total_joins": 21,
    "total_tables": 17,
    "analysis_timestamp": "2025-10-01T07:16:18.858707",
    "source_files": {
      "sql_file": "fulfillment_care_cost.sql",
      "context_file": "Breaking Down Logistic Care Costs Query.md"
    }
  },
  "table_catalog": {
    "adjustment_reporting": {
      "name": "adjustment_reporting",
      "full_name": "adjustment_reporting",
      "size_category": "large",
      "is_cte": true,
      "description": "",
      "estimated_rows": "5M+"
    },
    "ticket_fact": {
      "name": "ticket_fact",
      "full_name": "integrated_core.ticket_fact tf",
      "size_category": "large",
      "is_cte": false,
      "description": "",
      "estimated_rows": "10M+"
    },
    "primary_contact_reason": {
      "name": "primary_contact_reason",
      "full_name": "source_zendesk_ref.primary_contact_reason pr",
      "size_category": "small",
      "is_cte": false,
      "description": "",
      "estimated_rows": "<1K"
    },
    "secondary_contact_reason": {
      "name": "secondary_contact_reason",
      "full_name": "source_zendesk_ref.secondary_contact_reason sr",
      "size_category": "small",
      "is_cte": false,
      "description": "",
      "estimated_rows": "<1K"
    },
    "concession_reporting": {
      "name": "concession_reporting",
      "full_name": "concession_reporting",
      "size_category": "large",
      "is_cte": true,
      "description": "",
      "estimated_rows": "5M+"
    },
    "order_cancellation_fact": {
      "name": "order_cancellation_fact",
      "full_name": "order_cancellation_fact",
      "size_category": "large",
      "is_cte": true,
      "description": "",
      "estimated_rows": "1M+"
    },
    "cancellation_reason_map": {
      "name": "cancellation_reason_map",
      "full_name": "integrated_ref.cancellation_reason_map crm",
      "size_category": "medium",
      "is_cte": false,
      "description": "",
      "estimated_rows": "100K-1M"
    },
    "diner_ss_cancels": {
      "name": "diner_ss_cancels",
      "full_name": "diner_ss_cancels ccr",
      "size_category": "unknown",
      "is_cte": true,
      "description": "",
      "estimated_rows": "Unknown"
    },
    "order_contribution_profit_fact": {
      "name": "order_contribution_profit_fact",
      "full_name": "order_contribution_profit_fact",
      "size_category": "large",
      "is_cte": true,
      "description": "",
      "estimated_rows": "100M+"
    },
    "mdf": {
      "name": "mdf",
      "full_name": "mdf",
      "size_category": "derived",
      "is_cte": true,
      "description": "",
      "estimated_rows": "Variable"
    },
    "cancels": {
      "name": "cancels",
      "full_name": "cancels c",
      "size_category": "unknown",
      "is_cte": true,
      "description": "",
      "estimated_rows": "Unknown"
    },
    "adj": {
      "name": "adj",
      "full_name": "adj",
      "size_category": "derived",
      "is_cte": true,
      "description": "",
      "estimated_rows": "Variable"
    },
    "ghg": {
      "name": "ghg",
      "full_name": "ghg",
      "size_category": "derived",
      "is_cte": true,
      "description": "",
      "estimated_rows": "Variable"
    },
    "care_fg": {
      "name": "care_fg",
      "full_name": "care_fg",
      "size_category": "derived",
      "is_cte": true,
      "description": "",
      "estimated_rows": "Variable"
    },
    "contacts": {
      "name": "contacts",
      "full_name": "contacts",
      "size_category": "derived",
      "is_cte": true,
      "description": "",
      "estimated_rows": "Variable"
    },
    "care_cost_reasons": {
      "name": "care_cost_reasons",
      "full_name": "csv_sandbox.care_cost_reasons ccr",
      "size_category": "small",
      "is_cte": false,
      "description": "",
      "estimated_rows": "<100"
    },
    "o2": {
      "name": "o2",
      "full_name": "o2",
      "size_category": "derived",
      "is_cte": true,
      "description": "",
      "estimated_rows": "Variable"
    }
  },
  "join_analysis": [
    {
      "cte_name": null,
      "line_number": 8,
      "join_type": "LEFT JOIN",
      "left_table": "adjustment_reporting",
      "right_table": "ticket_fact",
      "left_size": "large",
      "right_size": "large",
      "current_order": "adjustment_reporting LEFT JOIN ticket_fact",
      "join_condition": "tf.ticket_id = ar.ticket_id AND tf.ticket_created_Date BETWEEN DATE_ADD('day', -1, DATE '{{start_date}}') AND DATE_AD...",
      "issue": null,
      "suggested_order": null,
      "priority": "low",
      "performance_impact": "Low"
    },
    {
      "cte_name": null,
      "line_number": 12,
      "join_type": "LEFT JOIN",
      "left_table": "ticket_fact",
      "right_table": "primary_contact_reason",
      "left_size": "large",
      "right_size": "small",
      "current_order": "ticket_fact LEFT JOIN primary_contact_reason",
      "join_condition": "pr.contact_reason_id = tf.primary_contact_reason",
      "issue": null,
      "suggested_order": null,
      "priority": "low",
      "performance_impact": "Low"
    },
    {
      "cte_name": null,
      "line_number": 15,
      "join_type": "LEFT JOIN",
      "left_table": "primary_contact_reason",
      "right_table": "secondary_contact_reason",
      "left_size": "small",
      "right_size": "small",
      "current_order": "primary_contact_reason LEFT JOIN secondary_contact_reason",
      "join_condition": "sr.contact_reason_id = tf.secondary_contact_reason",
      "issue": null,
      "suggested_order": null,
      "priority": "low",
      "performance_impact": "Low"
    },
    {
      "cte_name": "care_fg",
      "line_number": 48,
      "join_type": "LEFT JOIN",
      "left_table": "concession_reporting",
      "right_table": "ticket_fact",
      "left_size": "large",
      "right_size": "large",
      "current_order": "concession_reporting LEFT JOIN ticket_fact",
      "join_condition": "tf.ticket_id = cr.ticket_id AND tf.ticket_created_Date BETWEEN DATE_ADD('day', -1, DATE '{{start_date}}') AND DATE_AD...",
      "issue": null,
      "suggested_order": null,
      "priority": "low",
      "performance_impact": "Low"
    },
    {
      "cte_name": "care_fg",
      "line_number": 52,
      "join_type": "LEFT JOIN",
      "left_table": "ticket_fact",
      "right_table": "primary_contact_reason",
      "left_size": "large",
      "right_size": "small",
      "current_order": "ticket_fact LEFT JOIN primary_contact_reason",
      "join_condition": "pr.contact_reason_id = tf.primary_contact_reason",
      "issue": null,
      "suggested_order": null,
      "priority": "low",
      "performance_impact": "Low"
    },
    {
      "cte_name": "care_fg",
      "line_number": 55,
      "join_type": "LEFT JOIN",
      "left_table": "primary_contact_reason",
      "right_table": "secondary_contact_reason",
      "left_size": "small",
      "right_size": "small",
      "current_order": "primary_contact_reason LEFT JOIN secondary_contact_reason",
      "join_condition": "sr.contact_reason_id = tf.secondary_contact_reason",
      "issue": null,
      "suggested_order": null,
      "priority": "low",
      "performance_impact": "Low"
    },
    {
      "cte_name": "cancels",
      "line_number": 112,
      "join_type": "LEFT JOIN",
      "left_table": "order_cancellation_fact",
      "right_table": "cancellation_reason_map",
      "left_size": "large",
      "right_size": "medium",
      "current_order": "order_cancellation_fact LEFT JOIN cancellation_reason_map",
      "join_condition": "CAST(crm.cancel_reason_id AS VARCHAR) = CAST(ocf.primary_cancel_reason_id AS VARCHAR)",
      "issue": null,
      "suggested_order": null,
      "priority": "low",
      "performance_impact": "Low"
    },
    {
      "cte_name": "cancels",
      "line_number": 115,
      "join_type": "LEFT JOIN",
      "left_table": "cancellation_reason_map",
      "right_table": "ticket_fact",
      "left_size": "medium",
      "right_size": "large",
      "current_order": "cancellation_reason_map LEFT JOIN ticket_fact",
      "join_condition": "tf.ticket_id = CAST(ocf.cancellation_ticket_id AS BIGINT) AND tf.ticket_created_Date BETWEEN DATE_ADD('day', -1, DATE...",
      "issue": "Large table (ticket_fact) should typically be on the left side of JOIN for better performance",
      "suggested_order": "ticket_fact LEFT JOIN cancellation_reason_map",
      "priority": "high",
      "performance_impact": "High - can significantly reduce query execution time"
    },
    {
      "cte_name": "cancels",
      "line_number": 119,
      "join_type": "LEFT JOIN",
      "left_table": "ticket_fact",
      "right_table": "primary_contact_reason",
      "left_size": "large",
      "right_size": "small",
      "current_order": "ticket_fact LEFT JOIN primary_contact_reason",
      "join_condition": "pr.contact_reason_id = tf.primary_contact_reason",
      "issue": null,
      "suggested_order": null,
      "priority": "low",
      "performance_impact": "Low"
    },
    {
      "cte_name": "cancels",
      "line_number": 122,
      "join_type": "LEFT JOIN",
      "left_table": "primary_contact_reason",
      "right_table": "secondary_contact_reason",
      "left_size": "small",
      "right_size": "small",
      "current_order": "primary_contact_reason LEFT JOIN secondary_contact_reason",
      "join_condition": "sr.contact_reason_id = tf.secondary_contact_reason",
      "issue": null,
      "suggested_order": null,
      "priority": "low",
      "performance_impact": "Low"
    },
    {
      "cte_name": "cancels",
      "line_number": 125,
      "join_type": "LEFT JOIN",
      "left_table": "secondary_contact_reason",
      "right_table": "diner_ss_cancels",
      "left_size": "small",
      "right_size": "unknown",
      "current_order": "secondary_contact_reason LEFT JOIN diner_ss_cancels",
      "join_condition": "ccr.order_uuid = ocf.order_uuid",
      "issue": null,
      "suggested_order": null,
      "priority": "low",
      "performance_impact": "Low"
    },
    {
      "cte_name": "contacts",
      "line_number": 192,
      "join_type": "LEFT JOIN",
      "left_table": "ticket_fact",
      "right_table": "primary_contact_reason",
      "left_size": "large",
      "right_size": "small",
      "current_order": "ticket_fact LEFT JOIN primary_contact_reason",
      "join_condition": "pr.contact_reason_id = tf.primary_contact_reason",
      "issue": null,
      "suggested_order": null,
      "priority": "low",
      "performance_impact": "Low"
    },
    {
      "cte_name": "contacts",
      "line_number": 195,
      "join_type": "LEFT JOIN",
      "left_table": "primary_contact_reason",
      "right_table": "secondary_contact_reason",
      "left_size": "small",
      "right_size": "small",
      "current_order": "primary_contact_reason LEFT JOIN secondary_contact_reason",
      "join_condition": "sr.contact_reason_id = tf.secondary_contact_reason",
      "issue": null,
      "suggested_order": null,
      "priority": "low",
      "performance_impact": "Low"
    },
    {
      "cte_name": "o",
      "line_number": 291,
      "join_type": "JOIN",
      "left_table": "order_contribution_profit_fact",
      "right_table": "mdf",
      "left_size": "large",
      "right_size": "derived",
      "current_order": "order_contribution_profit_fact JOIN mdf",
      "join_condition": "mdf.order_uuid = cpf.order_uuid",
      "issue": null,
      "suggested_order": null,
      "priority": "low",
      "performance_impact": "Low"
    },
    {
      "cte_name": "o",
      "line_number": 294,
      "join_type": "LEFT JOIN",
      "left_table": "mdf",
      "right_table": "cancels",
      "left_size": "derived",
      "right_size": "unknown",
      "current_order": "mdf LEFT JOIN cancels",
      "join_condition": "c.order_uuid = cpf.order_uuid",
      "issue": null,
      "suggested_order": null,
      "priority": "low",
      "performance_impact": "Low"
    },
    {
      "cte_name": "o",
      "line_number": 297,
      "join_type": "LEFT JOIN",
      "left_table": "cancels",
      "right_table": "adj",
      "left_size": "unknown",
      "right_size": "derived",
      "current_order": "cancels LEFT JOIN adj",
      "join_condition": "adj.order_uuid = cpf.order_uuid",
      "issue": null,
      "suggested_order": null,
      "priority": "low",
      "performance_impact": "Low"
    },
    {
      "cte_name": "o",
      "line_number": 300,
      "join_type": "LEFT JOIN",
      "left_table": "adj",
      "right_table": "ghg",
      "left_size": "derived",
      "right_size": "derived",
      "current_order": "adj LEFT JOIN ghg",
      "join_condition": "ghg.order_uuid = cpf.order_uuid",
      "issue": null,
      "suggested_order": null,
      "priority": "low",
      "performance_impact": "Low"
    },
    {
      "cte_name": "o",
      "line_number": 303,
      "join_type": "LEFT JOIN",
      "left_table": "ghg",
      "right_table": "care_fg",
      "left_size": "derived",
      "right_size": "derived",
      "current_order": "ghg LEFT JOIN care_fg",
      "join_condition": "care_fg.order_uuid = cpf.order_uuid",
      "issue": null,
      "suggested_order": null,
      "priority": "low",
      "performance_impact": "Low"
    },
    {
      "cte_name": "o",
      "line_number": 306,
      "join_type": "LEFT JOIN",
      "left_table": "care_fg",
      "right_table": "contacts",
      "left_size": "derived",
      "right_size": "derived",
      "current_order": "care_fg LEFT JOIN contacts",
      "join_condition": "contacts.order_uuid = cpf.order_uuid",
      "issue": null,
      "suggested_order": null,
      "priority": "low",
      "performance_impact": "Low"
    },
    {
      "cte_name": "o",
      "line_number": 309,
      "join_type": "LEFT JOIN",
      "left_table": "contacts",
      "right_table": "care_cost_reasons",
      "left_size": "derived",
      "right_size": "small",
      "current_order": "contacts LEFT JOIN care_cost_reasons",
      "join_condition": "ccr.scr = contacts.latest_contact_reason",
      "issue": null,
      "suggested_order": null,
      "priority": "low",
      "performance_impact": "Low"
    },
    {
      "cte_name": "o3",
      "line_number": 428,
      "join_type": "LEFT JOIN",
      "left_table": "o2",
      "right_table": "cancellation_reason_map",
      "left_size": "derived",
      "right_size": "medium",
      "current_order": "o2 LEFT JOIN cancellation_reason_map",
      "join_condition": "LOWER(crm.cancel_reason_name) = LOWER(o2.adjustment_and_cancel_reason_combined)",
      "issue": null,
      "suggested_order": null,
      "priority": "low",
      "performance_impact": "Low"
    }
  ],
  "summary": {
    "critical_issues": 0,
    "high_priority": 1,
    "medium_priority": 0,
    "info_notes": 0
  }
}